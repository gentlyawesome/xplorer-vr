<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.3/howler.core.min.js"></script>
  </head>

  <body style="margin: 0; overflow: hidden" id="body"></body>

  <script type="text/javascript">
    ;(() => {
      window.addEventListener("message", receiveMessage, false)

      function receiveMessage(evnt) {
        console.log("iframe", evnt.data.value)

        const arLocations = evnt.data.value.locations.map(
          (location) =>
            `<a-entity
                gltf-model="#treasure"
                look-at="[gps-camera]" scale="1 1 1" gps-entity-place="latitude: ${location.lat}; longitude: ${location.lng};"
                animation="property: object3D.position.y; to: 0.0001; dir: alternate; dur: 2000; loop: true"
              ></a-entity>`
        )
        //`<a-image src="assets/asset.png" look-at="[gps-camera]" scale="1 1 1" gps-entity-place="latitude: ${location.lat}; longitude: ${location.lng};"></a-image>`

        const assets = `<a-assets>
          <item id="treasure" src="/assets/model/treasure.glb"></item>
          </a-assets>`

        document.getElementById("body").innerHTML += '<a-scene embedded loading-screen="enabled: false;" arjs="sourceType: webcam; debugUIEnabled: false;">'
        assets + arLocations + "<a-camera gps-camera rotation-reader></a-camera>" + "</a-scene>"
      }

      var sound = new Howl({
        src: ["./assets/sound/bg.mp3"],
      })

      sound.play()

      // window.parent.postMessage("test", "*")
    })()
  </script>
</html>
